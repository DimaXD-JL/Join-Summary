<section class="add-task-container">
  <div class="add-task-inner-container">
    <h2>Add Task</h2>
    <div class="add-task-form">
      <div class="form-left">
        <div class="form-container form-left-title">
          <label for="title">
            <p>Title</p>
          </label>
          <input type="text" id="title" name="title" required placeholder="Enter a Title" [(ngModel)]="title"
            class="custom-input" [class.ng-invalid]="titleInput.invalid && (titleInput.dirty || titleInput.touched)"
            #titleInput="ngModel" />
        </div>

        <div class="form-container form-left-description">
          <label for="description">
            <p>Description</p>
          </label>
          <textarea id="description" name="description" rows="4" placeholder="Enter a Description"
            [(ngModel)]="description" class="custom-input"></textarea>
        </div>

        <div class="form-container">
          <label>
            <p>Assigned to</p>
          </label>
          <div class="dropdown">
            <button (click)="toggleDropdown()" class="dropdown-button">
              <span>Select contacts to assign</span> <img src="../../../assets/icons/arrow-dropdown-down.png" alt="">
            </button>
            <div class="assign-container" [class.open]="dropdownOpen">
              <ul class="contact-list">
                @for (contact of contactList; track contact) {
                <label class="assignedStyle">
                  <div class="avatar" [ngStyle]="{ 'background-color': getAvatarColor(contact) }">
                    {{ getInitials(contact.name) }}
                  </div>
                  <div class="contactName">{{ contact.name }}</div>
                  <div class="checkContact">
                    <input type="checkbox" [value]="contact" (change)="toggleContactSelection(contact, $event)"
                      class="custom-input" />
                  </div>
                </label>
                }
              </ul>
            </div>
          </div>
        </div>
        @if (selectedContacts.length > 0) {
        <div class="assignedStyleSelected">
          @for (contact of selectedContacts; track contact) {
          <label>
            <div class="avatar" [ngStyle]="{ 'background-color': getAvatarColor(contact) }">
              {{ getInitials(contact.name) }}
            </div>
          </label>
          }
        </div>
        }
      </div>
      <div class="devider"></div>
      <div class="form-right">
        <p>Due Date</p>
        <input type="date" id="dueDate" name="dueDate" required [(ngModel)]="dueDate" placeholder="dd/mm/yyyy"
          class="custom-input" />

        <p>Prio</p>
        <div class="priority-buttons">
          <button type="button" class="priority-btn" data-priority="urgent" (click)="setPriority('urgent')">
            <span class="text">Urgent</span>
            <span class="icon"><img src="../../../assets/icons/prio_high.png" alt=""></span>
          </button>
          <button type="button" class="priority-btn" data-priority="medium" (click)="setPriority('medium')">
            <span class="text">Medium</span>
            <span class="icon"><img src="../../../assets/icons/prio_medium.png" alt=""></span>
          </button>
          <button type="button" class="priority-btn" data-priority="low" (click)="setPriority('low')">
            <span class="text">Low</span>
            <span class="icon"><img src="../../../assets/icons/prio_low.png" alt=""></span>
          </button>
        </div>

        <input type="hidden" id="selectedPriority" name="priority" [(ngModel)]="priority" />

        <p>Category</p>
        <select id="category" name="category" required [(ngModel)]="category" class="category-dropdown">
          <option value="">Select task category</option>
          <option value="Technical Task">Technical Task</option>
          <option value="User Story">User Story</option>
        </select>

        <p>Subtasks</p>
        <div class="subtask-container">
          <input type="text" id="subtaskInput" name="subtaskInput" [(ngModel)]="subtaskInput"
            placeholder="Add new subtask" />
          <button type="button" class="add-button custom-input" (click)="addSubtask()">
            +
          </button>
          <ul id="subtaskList">
            @for (subtask of subtasks; track subtask) {
            <li>{{ subtask }}</li>
            }
          </ul>
        </div>
      </div>
    </div>


    <div class="add-task-btn">
      <button class="cbtn cancelBtn" (click)="closeDialog()">Cancel</button>
      <button class="btn createBtn" [disabled]="!title || !dueDate || !category" (click)="addTodo()">
        Create Task
      </button>
    </div>
  </div>
</section>